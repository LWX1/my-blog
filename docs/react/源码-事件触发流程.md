---
title: React 事件触发
date: 2023-3-10
isShowComments: false
tags:
    - react源码
categories:
    - react源码
---

## 如何确定你点击的事件

- 通过映射关系，提前绑定事件dispatchDiscreteEvent 在容器中；
- 当再次点击事件，通过currentTarget 确定代理事件和target 确定当前事件，再通过internalInstanceKey 方法中保存得react实例，可以确定到那个fiber 的点击事件。

```js
// 提前把fiber 存储在dom中
const internalInstanceKey = '__reactFiber$' + randomKey;
function precacheFiberNode(hostInst,node){
    (node)[internalInstanceKey] = hostInst;
}

// 监听事件
targetContainer.addEventListener(eventType, dispatchDiscreteEvent, false);
targetContainer.addEventListener(eventType, dispatchDiscreteEvent, true);

// 触发事件
function dispatchDiscreteEvent(
  domEventName,
  eventSystemFlags,
  container,
  nativeEvent,
) {
  const previousPriority = getCurrentUpdatePriority();
  const prevTransition = ReactCurrentBatchConfig.transition;
  ReactCurrentBatchConfig.transition = null;
  try {
    setCurrentUpdatePriority(DiscreteEventPriority);
    dispatchEvent(domEventName, eventSystemFlags, container, nativeEvent);
  } finally {
    setCurrentUpdatePriority(previousPriority);
    ReactCurrentBatchConfig.transition = prevTransition;
  }
}
```